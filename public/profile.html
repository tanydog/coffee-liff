<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>プロフィール</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="/styles/coffee-design.css" />
</head>
<body>
  <div class="container" style="padding-bottom:90px;">
    <h1 class="h1">👤 プロフィール</h1>

    <section class="card" id="profileCard">
      <div style="display:flex;gap:1rem;align-items:center;">
        <img id="avatar" alt="プロフィール画像" src="" style="width:80px;height:80px;border-radius:50%;object-fit:cover;background:#eee;">
        <div>
          <div class="h3" id="displayName">読み込み中…</div>
          <div class="body-sm" id="userIdMasked"></div>
        </div>
      </div>

      <div class="card-footer" style="display:flex;gap:.5rem;flex-wrap:wrap;">
        <button id="copyUserId" class="btn btn-secondary btn-small">ユーザーIDをコピー</button>
        <button id="refreshBtn" class="btn btn-outline btn-small">再取得</button>
        <button id="logoutBtn" class="btn btn-outline btn-small">ログアウト</button>
      </div>

      <div class="alert alert-warning" id="notice" style="display:none;">
        <span>ℹ️</span>
        <span>ログインが必要です。LINEでログインするとプロフィールを表示します。</span>
      </div>
    </section>

    <section class="card">
      <div class="h4">連携情報</div>
      <div class="body-sm" id="tokenInfo">IDトークン: 未取得</div>
    </section>
  </div>

  <!-- 下部タブバー -->
  <footer style="position:fixed;bottom:0;left:0;width:100%;background:var(--white);border-top:1px solid var(--gray-300);display:flex;justify-content:space-around;padding:.5rem 0;z-index:10;">
    <a href="index.html" style="flex:1;text-align:center;">
      <div>☕<div style="font-size:.9em;">記録</div></div>
    </a>
    <a href="diagnosis.html" style="flex:1;text-align:center;">
      <div>🧪<div style="font-size:.9em;">診断</div></div>
    </a>
    <a href="result.html" style="flex:1;text-align:center;">
      <div>📊<div style="font-size:.9em;">傾向</div></div>
    </a>
    <a href="profile.html" style="flex:1;text-align:center;color:var(--coffee-primary);font-weight:600;">
      <div>👤<div style="font-size:.9em;">自分</div></div>
    </a>
  </footer>

  <!-- 読み込み順：config → LIFF → profile.js -->
  <script src="/config.js" defer></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js" defer></script>
  <script src="/profile.js" defer></script>

  <!-- 任意: 設定チェック -->
  <script defer>
    window.addEventListener('DOMContentLoaded', () => {
      if (!window.ENV || !window.ENV.LIFF?.DIAG) {
        console.warn('config.js の設定不足: ENV.LIFF.DIAG を設定してください');
      }
    });
  </script>
</body>
</html>
