<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>診断結果</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/styles/coffee-design.css" />
</head>
<body>
  <div class="container" style="padding-bottom:90px;">
    <section class="card" id="usageInsights">
      <div class="card-header">
        <h2 class="h2" style="margin-bottom:0.25rem;">📊 利用サマリー</h2>
        <p class="body-sm" style="margin-bottom:0;">直近の飲用傾向を自動で集計し、パーソナライズされた提案やロイヤルティ施策に活用できます。</p>
      </div>
      <div class="metric-grid" id="insightSummary" aria-live="polite"></div>
      <div class="metric-section">
        <h3 class="h4">直近のログ推移</h3>
        <div id="insightTrend" class="trend-list"></div>
      </div>
      <div class="metric-section">
        <h3 class="h4">人気の豆</h3>
        <div id="beanBreakdown" class="bean-list"></div>
      </div>
    </section>

    <section class="card" id="engagementCard">
      <div class="card-header" style="border:none;">
        <h2 class="h2" style="margin-bottom:0.25rem;">💡 リピーター強化プラン</h2>
        <p class="body-sm" style="margin-bottom:0;">AI が算出した傾向をもとに、パートナー向けのサブスクリプション施策をレコメンドします。</p>
      </div>
      <div class="engagement-grid" id="engagementGrid"></div>
    </section>

    <section class="card" id="resultCard">
      <div class="card-header">
        <h2 class="h2" style="margin-bottom:0;">☕ あなたのコーヒータイプ</h2>
        <p class="body-sm" style="margin-bottom:0;">診断結果に基づいておすすめの豆や体験が更新されます。</p>
      </div>
      <div id="resultsContainer" class="component-grid"></div>
    </section>
  </div>

  <!-- 下部タブバー -->
  <footer style="position:fixed;bottom:0;left:0;width:100%;background:var(--white);border-top:1px solid var(--gray-300);display:flex;justify-content:space-around;padding:0.5rem 0;z-index:10;">
    <a href="index.html" style="flex:1;text-align:center;color:var(--coffee-primary);font-weight:600;">
      <div>☕<div style="font-size:0.9em;">記録</div></div>
    </a>
    <a href="diagnosis.html" style="flex:1;text-align:center;">
      <div>🧪<div style="font-size:0.9em;">診断</div></div>
    </a>
    <a href="result.html" style="flex:1;text-align:center;">
      <div>📊<div style="font-size:0.9em;">傾向</div></div>
    </a>
    <a href="profile.html" style="flex:1;text-align:center;">
      <div>👤<div style="font-size:0.9em;">自分</div></div>
    </a>
  </footer>

  <!-- スクリプトの読み込み順を固定 -->
  <script src="/config.js" defer></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js" defer></script>
  <script src="/main-result.js" defer></script>

  <!-- 任意: 設定チェック -->
  <script defer>
    window.addEventListener('DOMContentLoaded', () => {
      const env = window.ENV || {};
      const hasLiffId = !!(env?.LIFF?.DIAG || env?.LIFF_ID);
      if (!hasLiffId || !env?.API_BASE) {
        console.warn('config.js の設定不足: ENV.LIFF.DIAG または ENV.LIFF_ID / ENV.API_BASE');
      }
    });
  </script>
</body>
</html>
