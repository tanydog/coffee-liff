# Coffee LIFF UI/UX Rebuild Plan

## 1. Design Principles
1. **Evidence-led Guidance**: 各ページが KPI（診断完了率・ログ継続率・送客率）に紐づくインタラクションを提供する。
2. **Mobile-first Rhythm**: LIFF ブラウザのビュー幅を前提に、スクロール 1 スクリーン内で目的が完結する構造を維持。
3. **Trust & Transparency**: 利用者がデータ利用方針と推奨理由を理解できるよう、診断結果に根拠と次アクションを添える。
4. **Operational Clarity**: 将来の AB テストやローカライズを想定し、コンポーネントとコピーを分離して管理する。

## 2. 主要ユーザージャーニー
### 2.1 ログ記録
- **ヒーローセクション**: 会員名と価値提案を冒頭に表示し、診断 CTA でコンバージョン導線を確保。
- **フォーム**: 豆・味わい・量をカード内フォームに集約。バリデーションは 1〜2000 ml の範囲チェックと未入力検知。
- **フィードバック**: 成功/失敗/警告を `notice` コンポーネントで提供し、学習データとして活用できるようログ化を想定。

### 2.2 診断
- **質問設計**: 5 問の単一選択。嗜好パターンと購買行動を分けた設問群で、TYPE スコアを算出。
- **回答体験**: カード型ラジオ UI、タップ時に選択状態を視覚化。未回答時はフォーム送信をブロックし注意喚起。
- **結果保存**: スコアマップと代表タイプを Functions に送信し、再訪時のパーソナライズに活用。

### 2.3 診断結果
- **サマリーカード**: ペルソナごとに絵文字・コピー・推奨豆を表示。外部リンクは `target="_blank"` + 追跡パラメータ対応を想定。
- **状態管理**: 診断未実施／読込中／取得失敗の 3 ステートを明示し、再診断やリロードの導線を提示。

### 2.4 プロフィール
- **接続確認**: ID トークンの有無、ユーザー ID のマスキング表示、プロフィール更新ボタンを配置。
- **ログアウト導線**: `liff.logout()` 実行後にログインページへリダイレクトし、セッション管理を明確化。

## 3. 情報設計
```
グローバルナビ
 ├─ 記録（ログ一覧 + 新規登録）
 ├─ 診断（質問フロー）
 ├─ 傾向（診断結果と推奨）
 └─ プロフィール（接続状態）
```
- 各ページは共通ヘッダー／通知コンポーネント／カードレイアウトを再利用。
- 診断と結果ページは `DiagnosisService` が返却するスコアフォーマットを前提に設計。

## 4. コンポーネントライブラリ
| コンポーネント | 用途 | 状態 |
| --- | --- | --- |
| `notice` | 成功・警告・エラー・情報のフィードバック | variant, title, message |
| `btn` | プライマリ/セカンダリ/アウトラインのアクションボタン | loading 状態は `spinner` を重畳 |
| `card` | セクションのコンテナ | highlight, standard |
| `option-card` | 診断のラジオ UI | default, selected |
| `entry-card` | ログ一覧の 1 アイテム | hover 時のエレベーション |

## 5. アクセシビリティ & 国際化
- 文字サイズ・色コントラストは WCAG 2.1 AA を満たす配色（`--coffee-primary` 系）で統一。
- ナビゲーションは `role="navigation"` を想定し、フォーカスリングを CSS 変数で制御。
- 将来的な多言語展開に備え、主要コピーを JSON へ切り出す計画をロードマップに追加。

## 6. 計測計画
- イベント: `logbook_submit`, `logbook_fail`, `diagnosis_complete`, `diagnosis_retry`, `recommendation_click`。
- 設問ごとの離脱率を把握するため、FormData 送信前に `question_answered` イベントをバッチ化。
- プロフィールページのトークン取得失敗は運用コスト増につながるため、Sentry/BigQuery に送出。

## 7. 実装スプリント
1. **Sprint A**: デザインシステム（トークン、カード、ボタン、通知）移植。
2. **Sprint B**: ログ記録ページのフォーム + API 連携。
3. **Sprint C**: 診断フロー（質問レンダリング、集計、保存）。
4. **Sprint D**: 結果表示と推奨カードの接続。
5. **Sprint E**: プロフィール、ログアウト、テレメトリ実装。

## 8. 成功指標
- 診断完了率 ≥ 65%
- 診断後の推奨リンク CTR ≥ 40%
- ログの週次継続率 ≥ 45%
- セッション当たり平均所要時間 ≤ 4 分
